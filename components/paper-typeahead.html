<dom-module id="paper-typeahead">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
      width:50%;
    }
  </style>

  <template>
    <!-- TODO: POST -->
    <iron-ajax
    auto
    url="{{ remoteUrl }}"
    method="GET"
    handle-as="json"
    on-response="_handleResponse"
    debounce-duration="500"></iron-ajax>

    <h4>Servicio</h4>
    <paper-input value="{{ serviceValue }}"></paper-input>
    <h4>Query</h4>
    <paper-input value="{{ queryValue }}"></paper-input>

    <template is="dom-if" if="{{ results.length }}">
      <paper-material>
        <paper-menu>
          <template is="dom-repeat" items="{{ results }}">
            <paper-item>
              <span>{{ item }}</span>
            </paper-item>
          </template>
        </paper-menu>
      </paper-material>
    </template>

  </template>

</dom-module>

<script>

  'use-strict';

  Polymer({
    is: 'paper-typeahead',
    properties:{
      serverUrl: {
        value: 'http://52.18.67.14',
        readOnly: true 
      },
      remoteUrl: {
        value: '',
        type: String,
        notify: true
      },
      queryValue: {
        type: String,
        notify: true,
        observer: '_queryValueChanged'
      },
      serviceValue: {
        type: String,
        notify: true,
        observer: '_serviceValueChanged',
        value: 'lechuckcors'
      },
      results: {
        type: Array,
        value: []
      }
    },
    ready: function(){

    },
    _handleResponse: function(event){
      var response = event.detail.response;
      if(this.queryValue !== ''){
        this.results = response.map(function(item){
          return item.data;
        });
      }
    },
    _queryValueChanged: function(newValue, oldValue){
      if(newValue == ''){
        this.remoteUrl = this.serverUrl;
      }else{
        if(newValue.length > 1){
          this.remoteUrl = this.serverUrl + '/' + this.serviceValue +'/search?text=' + newValue;
        }else{
          this.results = [];
        }
      }
    },
    _serviceValueChanged: function(newValue, oldValue){
      if(newValue == ''){
        this.remoteUrl = this.serverUrl;
      }else{
        if(newValue.length > 1){
          this.remoteUrl = this.serverUrl + '/' + newValue +'/search?text=' + this.queryValue;
        }else{
          this.results = [];
        }
      }
    }
  });

</script>
